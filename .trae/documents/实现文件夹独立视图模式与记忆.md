# 实现文件夹视图记忆与独立切换模式

根据您的需求，我们将实现每个文件夹独立记录其视图模式（看板/网格/列表），并优化切换逻辑。

## 1. 状态管理升级 (State Management)

*   **当前状态**: `App.jsx` 中的 `viewMode` 是一个全局状态，切换后应用于所有层级。
*   **目标状态**:
    *   移除单一的 `viewMode` 状态。
    *   引入 `folderViewModes` 对象（或 Map），键为文件夹路径，值为该路径对应的视图模式。
    *   从 `localStorage` 中持久化读取/保存这个映射表，实现历史记忆。

## 2. 交互逻辑调整 (Interaction Logic)

*   **TopBar 切换**:
    *   点击右上角切换按钮时，不再切换全局模式。
    *   改为仅更新 **当前路径 (`currentPath`)** 在 `folderViewModes` 中的值。
    *   默认模式逻辑：如果某个路径从未设置过模式，默认使用 `dashboard`（看板）模式。

*   **渲染逻辑**:
    *   在渲染 `DashboardView`、`FileGrid` 或 `FileList` 时，根据 `folderViewModes[currentPath] || 'dashboard'` 来决定显示哪个组件。

## 3. 持久化存储 (Persistence)

*   使用 `localStorage.setItem('folderViewModes', ...)` 在每次变更时保存。
*   在 `App` 初始化时读取。

## 4. 后端适配 (Backend Adaptation)

*   `fetchFiles` 调用时，根据当前路径的视图模式决定 `depth` 参数：
    *   看板模式 (`dashboard`) -> `depth = 2`
    *   其他模式 -> `depth = 1`

## 执行步骤

1.  **修改 App.jsx**:
    *   初始化 `folderViewModes` 状态。
    *   修改 `handleToggleView` 函数，使其只更新当前路径的模式。
    *   在 `useEffect` 中根据当前路径的模式调用 `fetchFiles`。
2.  **更新 TopBar**:
    *   确保按钮图标反映的是**当前路径**的视图模式。

这样，每个层级（如根目录、一级文件夹、二级文件夹）都可以独立选择最适合它的展示方式，并且系统会记住您的选择。
