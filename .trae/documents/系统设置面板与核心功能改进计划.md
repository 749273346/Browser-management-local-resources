# 系统设置面板与核心功能改进计划

根据您的需求，我们将分五个阶段完善系统：

## 1. 目录地址管理 (Directory Management)
- **设置面板改进**: 
    - 重构 `SettingsModal.jsx`，新增「目录管理」标签页。
    - 显示当前根目录，并提供「更改目录」按钮，调用后端 `pick-folder` 接口。
- **历史记录**: 
    - 使用 `localStorage` 存储最近使用的 3 个路径。
    - 在设置面板中展示历史记录列表，支持一键切换。
- **验证机制**: 后端已具备路径验证能力，前端在切换时将再次确认。

## 2. 右键新建文件修复 (Right-Click New File)
- **逻辑修复**: 
    - 检查 `App.jsx` 中 `handleMenuAction` 的 `new-file-*` 逻辑。
    - 确保 `createFile` 方法在 `useFileSystem` Hook 中正确定义并导出。
    - 修复文件名后缀处理逻辑，避免重复后缀（如 `.txt.txt`）。
- **文件列表更新**: 确保创建成功后立即调用 `fetchFiles` 刷新列表。

## 3. 背景更换功能增强 (Background Settings)
- **机制优化**: 
    - 完善 `SettingsModal.jsx` 中的背景应用逻辑，确保 `bgImage` 状态正确更新 CSS 变量。
    - 修复「无背景」选项，确保能清除 `localStorage` 中的背景设置。
- **预览功能**: 当前已具备基本的预览区域，将进一步优化预览体验。

## 4. UI 反馈与界面优化 (UI Feedback & Polish)
- **Toast 提示**: 
    - 创建全局 `Toast` 组件。
    - 在文件操作（新建、重命名、删除、更改目录）成功或失败时显示 Toast 提示，替代原生的 `alert`。
- **统一风格**: 确保设置面板中的新标签页与现有风格保持一致（Material Design）。

## 5. 测试与验证 (Testing)
- **单元测试**: 针对 `useFileSystem` 和路径处理逻辑编写测试（视项目架构而定，主要侧重人工验证）。
- **兼容性**: 验证路径分隔符在 Windows 环境下的处理。

## 执行计划
1.  **重构设置面板**: 实现目录管理界面与逻辑。
2.  **修复新建文件**: 完善后缀处理与 API 调用。
3.  **增强背景设置**: 优化应用逻辑与反馈。
4.  **添加 Toast 组件**: 替换原生弹窗，提升体验。
