const f="http://localhost:3001",h=e=>{const t=String(e||"").trim();return t?/^[a-zA-Z]:$/.test(t)?`${t}\\`:/^[a-zA-Z]:\\$/.test(t)?t:null:null},l=e=>{const t=chrome.runtime.getURL("index.html");if(!e)return t;const r=new URL(t);return r.searchParams.set("path",e),r.searchParams.set("source","usb"),r.toString()},d=e=>{const t=h(e);return t?t[0].toUpperCase():null},b=e=>{const t=String(e||"").trim();if(!t)return null;const r=t.match(/^([a-zA-Z]):\\/);return r?r[1].toUpperCase():null},y=async()=>{try{const e=await fetch(`${f}/api/removable-drives`,{cache:"no-store"});if(!e.ok)return[];const t=await e.json();return(Array.isArray(t==null?void 0:t.drives)?t.drives:[]).map(h).filter(Boolean)}catch{return[]}},a=async()=>{const e=await y(),t=chrome.runtime.getURL("index.html");let r=[];try{r=await chrome.tabs.query({})}catch{r=[]}let s=!1;const c=new Set;for(const n of r)if(!(!(n!=null&&n.url)||!n.url.startsWith(t)))try{const o=new URL(n.url),i=o.searchParams.get("source"),m=o.searchParams.get("path");if(i==="usb"){const u=b(m);u&&c.add(u)}else s=!0}catch{}if(!s)try{await chrome.tabs.create({url:l(null)})}catch{}for(const n of e){const o=d(n);if(!(!o||c.has(o)))try{await chrome.tabs.create({url:l(n)})}catch{}}};chrome.action.onClicked.addListener(()=>{a()});chrome.runtime.onStartup.addListener(()=>{a()});chrome.runtime.onInstalled.addListener(()=>{a()});chrome.runtime.onMessage.addListener((e,t,r)=>!e||typeof e!="object"||e.type!=="open-main-and-usb-tabs"?!1:(a().then(()=>r({ok:!0})).catch(s=>r({ok:!1,error:String(s&&s.message?s.message:s)})),!0));
