const d="http://localhost:3001",h=r=>{const t=String(r||"").trim();return t?/^[a-zA-Z]:$/.test(t)?`${t}\\`:/^[a-zA-Z]:\\$/.test(t)?t:null:null},l=r=>{const t=chrome.runtime.getURL("index.html");if(!r)return t;const e=new URL(t);return e.searchParams.set("path",r),e.searchParams.set("source","usb"),e.toString()},f=r=>{const t=h(r);return t?t[0].toUpperCase():null},y=r=>{const t=String(r||"").trim();if(!t)return null;const e=t.match(/^([a-zA-Z]):\\/);return e?e[1].toUpperCase():null},b=async()=>{try{const r=await fetch(`${d}/api/removable-drives`,{cache:"no-store"});if(!r.ok)return[];const t=await r.json();return(Array.isArray(t==null?void 0:t.drives)?t.drives:[]).map(h).filter(Boolean)}catch{return[]}},o=async()=>{const r=await b(),t=chrome.runtime.getURL("index.html");let e=[];try{e=await chrome.tabs.query({})}catch{e=[]}let a=!1;const c=new Set;for(const n of e)if(!(!(n!=null&&n.url)||!n.url.startsWith(t)))try{const s=new URL(n.url),i=s.searchParams.get("source"),m=s.searchParams.get("path");if(i==="usb"){const u=y(m);u&&c.add(u)}else a=!0}catch{}if(!a)try{await chrome.tabs.create({url:l(null)})}catch{}for(const n of r){const s=f(n);if(!(!s||c.has(s)))try{await chrome.tabs.create({url:l(n)})}catch{}}};chrome.action.onClicked.addListener(()=>{o()});chrome.runtime.onStartup.addListener(()=>{o()});chrome.runtime.onInstalled.addListener(()=>{o()});
